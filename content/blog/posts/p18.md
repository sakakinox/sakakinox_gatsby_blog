---
title: plesk+CentOS7環境でMariDBを5.5->10.xにアップグレードする
date: 2021-08-19
published: true
tags: ["Develop", "Plesk", "MariaDB", "CentOS"]
---

## Plesk の MariaDB 対応状態

| plesk バージョン            | MariaDB バージョン |
| --------------------------- | ------------------ |
| Plesk Obsidian 18.0.30 以上 | MariaDB 10.5 以下  |
| Plesk Obsidian 18.0.30 以下 | MariaDB 10.3 以下  |
| Plesk Onyx                  | MariaDB 10.3 以下  |

## Auto アップグレード

Plesk がオートインストーラを作っているので自動でアップグレードできる。
今回は MariaDB10.5 にアップグレードした。
スクリプトの中で/tmp にバックアップを取得しているのでこのまま実行しても問題なさそう。

```
# wget https://plesk.zendesk.com/hc/article_attachments/360022419980/mariadb-10.5-upgrade.sh && chmod +x mariadb-10.5-upgrade.sh
```

```shell
#!/bin/bash

echo "Dumping all databases"
MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysqldump -u admin --verbose --all-databases --routines --triggers > /tmp/all-databases.sql 2&> /dev/null

#avoid inconsistency with repo if one exists
if [ -f "/etc/yum.repos.d/MariaDB.repo" ] ; then
  mv /etc/yum.repos.d/MariaDB.repo /etc/yum.repos.d/mariadb.repo
fi

#Stopping MariaDB
echo "stopping MariaDB service"
systemctl stop mariadb


echo "creating backup of mysql directory"
cp -v -a /var/lib/mysql/ /var/lib/mysql_backup 2&> /dev/null

echo "removing mysql-server package in case it exists"
rpm -e --nodeps "`rpm -q --whatprovides mysql-server`"

echo "Upgrading MariaDB"

echo "#http://downloads.mariadb.org/mariadb/repositories/
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.5/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1" > /etc/yum.repos.d/mariadb.repo

yum install MariaDB-client MariaDB-server MariaDB-compat MariaDB-shared -y

systemctl restart mariadb

MYSQL_PWD=`cat /etc/psa/.psa.shadow` mysql_upgrade -uadmin

systemctl restart mariadb

echo "Informing Plesk of the changes (plesk sbin packagemng -sdf)"
plesk sbin packagemng -sdf

systemctl start mariadb # to start MariaDB if not started
systemctl enable mariadb # to make sure that MariaDB will start after the server reboot automatically

```

## 実行結果

```shell
[root@server ~]# ./mariadb-10.5-upgrade.sh
Dumping all databases
stopping MariaDB service
creating backup of mysql directory
removing mysql-server package in case it exists
error: package no package provides mysql-server is not installed
Upgrading MariaDB
Loaded plugins: fastestmirror, priorities
Determining fastest mirrors
 * elrepo: ftp.ne.jp
 * remi-safe: ftp.riken.jp
 * rpmforge: kartolo.sby.datautama.net.id
PLESK_17_PHP56                                                                                                                                                                              | 2.9 kB  00:00:00
PLESK_17_PHP70                                                                                                                                                                              | 2.9 kB  00:00:00
PLESK_17_PHP73                                                                                                                                                                              | 2.9 kB  00:00:00
PLESK_17_PHP74                                                                                                                                                                              | 2.9 kB  00:00:00
PLESK_17_PHP80                                                                                                                                                                              | 2.9 kB  00:00:00
PLESK_18_0_36-extras                                                                                                                                                                        | 2.9 kB  00:00:00
base                                                                                                                                                                                        | 3.6 kB  00:00:00
elrepo                                                                                                                                                                                      | 3.0 kB  00:00:00
extras                                                                                                                                                                                      | 2.9 kB  00:00:00
kernelcare                                                                                                                                                                                  | 3.0 kB  00:00:00
mariadb                                                                                                                                                                                     | 3.4 kB  00:00:00
plesk-ext-grafana                                                                                                                                                                           | 3.0 kB  00:00:00
plesk-ext-panel-migrator                                                                                                                                                                    | 2.9 kB  00:00:00
remi-safe                                                                                                                                                                                   | 3.0 kB  00:00:00
rpmforge                                                                                                                                                                                    | 1.9 kB  00:00:00
updates                                                                                                                                                                                     | 2.9 kB  00:00:00
(1/17): PLESK_17_PHP74/primary_db                                                                                                                                                           |  17 kB  00:00:00
(2/17): PLESK_17_PHP73/primary_db                                                                                                                                                           |  17 kB  00:00:00
(3/17): PLESK_18_0_36-extras/primary_db                                                                                                                                                     |  39 kB  00:00:00
(4/17): base/7/x86_64/group_gz                                                                                                                                                              | 153 kB  00:00:00
(5/17): base/7/x86_64/primary_db                                                                                                                                                            | 6.1 MB  00:00:00
(6/17): extras/7/x86_64/primary_db                                                                                                                                                          | 242 kB  00:00:00
(7/17): PLESK_17_PHP80/primary_db                                                                                                                                                           |  17 kB  00:00:00
(8/17): PLESK_17_PHP56/primary_db                                                                                                                                                           |  14 kB  00:00:00
(9/17): PLESK_17_PHP70/primary_db                                                                                                                                                           |  14 kB  00:00:00
(10/17): elrepo/primary_db                                                                                                                                                                  | 395 kB  00:00:00
(11/17): plesk-ext-panel-migrator/primary_db                                                                                                                                                | 8.6 kB  00:00:00
(12/17): mariadb/updateinfo                                                                                                                                                                 | 5.7 kB  00:00:00
(13/17): updates/7/x86_64/primary_db                                                                                                                                                        | 9.6 MB  00:00:00
(14/17): kernelcare/7/x86_64/primary_db                                                                                                                                                     |  40 kB  00:00:01
(15/17): mariadb/primary_db                                                                                                                                                                 |  70 kB  00:00:01
(16/17): plesk-ext-grafana/primary_db                                                                                                                                                       | 108 kB  00:00:00
(17/17): remi-safe/primary_db                                                                                                                                                               | 2.0 MB  00:00:01
rpmforge/primary_db                                                                                                                                                                         | 125 kB  00:00:01
30 packages excluded due to repository priority protections
Resolving Dependencies
--> Running transaction check
---> Package MariaDB-client.x86_64 0:10.5.12-1.el7.centos will be obsoleting
--> Processing Dependency: MariaDB-common for package: MariaDB-client-10.5.12-1.el7.centos.x86_64
--> Processing Dependency: libpcre2-8.so.0()(64bit) for package: MariaDB-client-10.5.12-1.el7.centos.x86_64
---> Package MariaDB-compat.x86_64 0:10.5.12-1.el7.centos will be obsoleting
---> Package MariaDB-server.x86_64 0:10.5.12-1.el7.centos will be obsoleting
--> Processing Dependency: galera-4 for package: MariaDB-server-10.5.12-1.el7.centos.x86_64
---> Package MariaDB-shared.x86_64 0:10.5.12-1.el7.centos will be installed
---> Package mariadb.x86_64 1:5.5.68-1.el7 will be obsoleted
---> Package mariadb-libs.x86_64 1:5.5.68-1.el7 will be obsoleted
---> Package mariadb-server.x86_64 1:5.5.68-1.el7 will be obsoleted
--> Running transaction check
---> Package MariaDB-common.x86_64 0:10.5.12-1.el7.centos will be installed
---> Package galera-4.x86_64 0:26.4.9-1.el7.centos will be installed
--> Processing Dependency: socat for package: galera-4-26.4.9-1.el7.centos.x86_64
--> Processing Dependency: libboost_program_options-mt.so.1.53.0()(64bit) for package: galera-4-26.4.9-1.el7.centos.x86_64
---> Package pcre2.x86_64 0:10.23-2.el7 will be installed
--> Running transaction check
---> Package boost-program-options.x86_64 0:1.53.0-28.el7 will be installed
---> Package socat.x86_64 0:1.7.3.2-2.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

===================================================================================================================================================================================================================
 Package                                                   Arch                                       Version                                                    Repository                                   Size
===================================================================================================================================================================================================================
Installing:
 MariaDB-client                                            x86_64                                     10.5.12-1.el7.centos                                       mariadb                                      13 M
     replacing  mariadb.x86_64 1:5.5.68-1.el7
 MariaDB-compat                                            x86_64                                     10.5.12-1.el7.centos                                       mariadb                                     2.2 M
     replacing  mariadb-libs.x86_64 1:5.5.68-1.el7
 MariaDB-server                                            x86_64                                     10.5.12-1.el7.centos                                       mariadb                                      27 M
     replacing  mariadb-server.x86_64 1:5.5.68-1.el7
 MariaDB-shared                                            x86_64                                     10.5.12-1.el7.centos                                       mariadb                                     112 k
Installing for dependencies:
 MariaDB-common                                            x86_64                                     10.5.12-1.el7.centos                                       mariadb                                      81 k
 boost-program-options                                     x86_64                                     1.53.0-28.el7                                              base                                        156 k
 galera-4                                                  x86_64                                     26.4.9-1.el7.centos                                        mariadb                                     9.6 M
 pcre2                                                     x86_64                                     10.23-2.el7                                                base                                        201 k
 socat                                                     x86_64                                     1.7.3.2-2.el7                                              base                                        290 k

Transaction Summary
===================================================================================================================================================================================================================
Install  4 Packages (+5 Dependent packages)

Total download size: 52 M
Downloading packages:
warning: /var/cache/yum/x86_64/7/mariadb/packages/MariaDB-common-10.5.12-1.el7.centos.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 1bb943db: NOKEY                           ] 136 kB/s | 140 kB  00:06:29 ETA
Public key for MariaDB-common-10.5.12-1.el7.centos.x86_64.rpm is not installed
(1/9): MariaDB-common-10.5.12-1.el7.centos.x86_64.rpm                                                                                                                                       |  81 kB  00:00:01
(2/9): MariaDB-compat-10.5.12-1.el7.centos.x86_64.rpm                                                                                                                                       | 2.2 MB  00:00:02
(3/9): MariaDB-client-10.5.12-1.el7.centos.x86_64.rpm                                                                                                                                       |  13 MB  00:00:05
(4/9): boost-program-options-1.53.0-28.el7.x86_64.rpm                                                                                                                                       | 156 kB  00:00:00
(5/9): MariaDB-shared-10.5.12-1.el7.centos.x86_64.rpm                                                                                                                                       | 112 kB  00:00:00
(6/9): pcre2-10.23-2.el7.x86_64.rpm                                                                                                                                                         | 201 kB  00:00:00
(7/9): socat-1.7.3.2-2.el7.x86_64.rpm                                                                                                                                                       | 290 kB  00:00:00
(8/9): MariaDB-server-10.5.12-1.el7.centos.x86_64.rpm                                                                                                                                       |  27 MB  00:00:04
(9/9): galera-4-26.4.9-1.el7.centos.x86_64.rpm                                                                                                                                              | 9.6 MB  00:00:02
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                                                              5.9 MB/s |  52 MB  00:00:08
Retrieving key from https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
Importing GPG key 0x1BB943DB:
 Userid     : "MariaDB Package Signing Key <package-signing-key@mariadb.org>"
 Fingerprint: 1993 69e5 404b d5fc 7d2f e43b cbcb 082a 1bb9 43db
 From       : https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : MariaDB-compat-10.5.12-1.el7.centos.x86_64                                                                                                                                                     1/12
  Installing : MariaDB-common-10.5.12-1.el7.centos.x86_64                                                                                                                                                     2/12
warning: /etc/my.cnf created as /etc/my.cnf.rpmnew
  Installing : pcre2-10.23-2.el7.x86_64                                                                                                                                                                       3/12
  Installing : MariaDB-client-10.5.12-1.el7.centos.x86_64                                                                                                                                                     4/12
  Installing : boost-program-options-1.53.0-28.el7.x86_64                                                                                                                                                     5/12
  Installing : socat-1.7.3.2-2.el7.x86_64                                                                                                                                                                     6/12
  Installing : galera-4-26.4.9-1.el7.centos.x86_64                                                                                                                                                            7/12
  Installing : MariaDB-server-10.5.12-1.el7.centos.x86_64                                                                                                                                                     8/12
  Installing : MariaDB-shared-10.5.12-1.el7.centos.x86_64                                                                                                                                                     9/12
  Erasing    : 1:mariadb-server-5.5.68-1.el7.x86_64                                                                                                                                                          10/12
warning: /var/log/mariadb/mariadb.log saved as /var/log/mariadb/mariadb.log.rpmsave
  Erasing    : 1:mariadb-5.5.68-1.el7.x86_64                                                                                                                                                                 11/12
  Erasing    : 1:mariadb-libs-5.5.68-1.el7.x86_64                                                                                                                                                            12/12
  Verifying  : pcre2-10.23-2.el7.x86_64                                                                                                                                                                       1/12
  Verifying  : MariaDB-common-10.5.12-1.el7.centos.x86_64                                                                                                                                                     2/12
  Verifying  : MariaDB-server-10.5.12-1.el7.centos.x86_64                                                                                                                                                     3/12
  Verifying  : MariaDB-shared-10.5.12-1.el7.centos.x86_64                                                                                                                                                     4/12
  Verifying  : galera-4-26.4.9-1.el7.centos.x86_64                                                                                                                                                            5/12
  Verifying  : MariaDB-client-10.5.12-1.el7.centos.x86_64                                                                                                                                                     6/12
  Verifying  : MariaDB-compat-10.5.12-1.el7.centos.x86_64                                                                                                                                                     7/12
  Verifying  : socat-1.7.3.2-2.el7.x86_64                                                                                                                                                                     8/12
  Verifying  : boost-program-options-1.53.0-28.el7.x86_64                                                                                                                                                     9/12
  Verifying  : 1:mariadb-libs-5.5.68-1.el7.x86_64                                                                                                                                                            10/12
  Verifying  : 1:mariadb-5.5.68-1.el7.x86_64                                                                                                                                                                 11/12
  Verifying  : 1:mariadb-server-5.5.68-1.el7.x86_64                                                                                                                                                          12/12

Installed:
  MariaDB-client.x86_64 0:10.5.12-1.el7.centos        MariaDB-compat.x86_64 0:10.5.12-1.el7.centos        MariaDB-server.x86_64 0:10.5.12-1.el7.centos        MariaDB-shared.x86_64 0:10.5.12-1.el7.centos

Dependency Installed:
  MariaDB-common.x86_64 0:10.5.12-1.el7.centos      boost-program-options.x86_64 0:1.53.0-28.el7      galera-4.x86_64 0:26.4.9-1.el7.centos      pcre2.x86_64 0:10.23-2.el7      socat.x86_64 0:1.7.3.2-2.el7

Replaced:
  mariadb.x86_64 1:5.5.68-1.el7                                     mariadb-libs.x86_64 1:5.5.68-1.el7                                     mariadb-server.x86_64 1:5.5.68-1.el7

Complete!
Phase 1/7: Checking and upgrading mysql database
Processing databases
mysql
mysql.columns_priv                                 OK
mysql.db                                           OK
mysql.event                                        OK
mysql.func                                         OK
mysql.help_category                                OK
mysql.help_keyword                                 OK
mysql.help_relation                                OK
mysql.help_topic                                   OK
mysql.host                                         OK
mysql.ndb_binlog_index                             OK
mysql.plugin                                       OK
mysql.proc                                         OK
mysql.procs_priv                                   OK
mysql.proxies_priv                                 OK
mysql.servers                                      OK
mysql.tables_priv                                  OK
mysql.time_zone                                    OK
mysql.time_zone_leap_second                        OK
mysql.time_zone_name                               OK
mysql.time_zone_transition                         OK
mysql.time_zone_transition_type                    OK
mysql.user                                         OK
Upgrading from a version before MariaDB-10.1
Phase 2/7: Installing used storage engines
Checking for tables with unknown storage engine
Phase 3/7: Fixing views
Phase 4/7: Running 'mysql_fix_privilege_tables'
Phase 5/7: Fixing table and database names
Phase 6/7: Checking and upgrading tables
Processing databases
apsc
apsc.aps_application                               OK
apsc.aps_application_backup                        OK
apsc.aps_log_param                                 OK
apsc.aps_package                                   OK
apsc.aps_package_configuration                     OK
apsc.aps_package_global_setting                    OK
apsc.aps_package_resource_configuration            OK
apsc.aps_package_resource_setting                  OK
apsc.aps_package_series                            OK
apsc.aps_package_service                           OK
apsc.aps_registry_object                           OK
apsc.aps_registry_object_setting                   OK
apsc.aps_registry_object_tag                       OK
apsc.aps_resource                                  OK
apsc.aps_resource_adjacency_list                   OK
apsc.aps_resource_backup                           OK
apsc.aps_resource_log                              OK
apsc.aps_resource_requirement                      OK
apsc.aps_resource_requirement_backup               OK
apsc.aps_resource_usage_counter                    OK
apsc.aps_resource_usage_report                     OK
apsc.aps_settings_sequenses                        OK
apsc.meta_info                                     OK
development_wp_zrwo8
development_wp_zrwo8.rSv10_commentmeta             OK
development_wp_zrwo8.rSv10_comments                OK
development_wp_zrwo8.rSv10_links                   OK
development_wp_zrwo8.rSv10_options                 OK
development_wp_zrwo8.rSv10_postmeta                OK
development_wp_zrwo8.rSv10_posts                   OK
development_wp_zrwo8.rSv10_siteguard_history       OK
development_wp_zrwo8.rSv10_siteguard_login         OK
development_wp_zrwo8.rSv10_term_relationships      OK
development_wp_zrwo8.rSv10_term_taxonomy           OK
development_wp_zrwo8.rSv10_termmeta                OK
development_wp_zrwo8.rSv10_terms                   OK
development_wp_zrwo8.rSv10_usermeta                OK
development_wp_zrwo8.rSv10_users                   OK
development_wp_zrwo8.rSv10_yoast_indexable         OK
development_wp_zrwo8.rSv10_yoast_indexable_hierarchy OK
development_wp_zrwo8.rSv10_yoast_migrations        OK
development_wp_zrwo8.rSv10_yoast_primary_term      OK
development_wp_zrwo8.rSv10_yoast_seo_links         OK
horde
horde.content_schema_info                          OK
horde.horde_activesync_cache                       OK
horde.horde_activesync_device                      OK
horde.horde_activesync_device_users                OK
horde.horde_activesync_mailmap                     OK
horde.horde_activesync_map                         OK
horde.horde_activesync_schema_info                 OK
horde.horde_activesync_state                       OK
horde.horde_alarm_schema_info                      OK
horde.horde_alarms                                 OK
horde.horde_auth_schema_info                       OK
horde.horde_cache                                  OK
horde.horde_cache_schema_info                      OK
horde.horde_core_schema_info                       OK
horde.horde_dav_collections                        OK
horde.horde_dav_objects                            OK
horde.horde_dav_schema_info                        OK
horde.horde_group_schema_info                      OK
horde.horde_groups                                 OK
horde.horde_groups_members                         OK
horde.horde_histories                              OK
horde.horde_histories_modseq                       OK
horde.horde_history_schema_info                    OK
horde.horde_imap_client_data                       OK
horde.horde_imap_client_message                    OK
horde.horde_imap_client_metadata                   OK
horde.horde_imap_client_schema_info                OK
horde.horde_lock_schema_info                       OK
horde.horde_locks                                  OK
horde.horde_muvfs                                  OK
horde.horde_perms                                  OK
horde.horde_perms_schema_info                      OK
horde.horde_prefs                                  OK
horde.horde_prefs_schema_info                      OK
horde.horde_queue_schema_info                      OK
horde.horde_queue_tasks                            OK
horde.horde_sessionhandler                         OK
horde.horde_sessionhandler_schema_info             OK
horde.horde_signups                                OK
horde.horde_syncml_anchors                         OK
horde.horde_syncml_map                             OK
horde.horde_syncml_schema_info                     OK
horde.horde_token_schema_info                      OK
horde.horde_tokens                                 OK
horde.horde_users                                  OK
horde.horde_vfs                                    OK
horde.horde_vfs_schema_info                        OK
horde.imp_schema_info                              OK
horde.imp_sentmail                                 OK
horde.ingo_forwards                                OK
horde.ingo_lists                                   OK
horde.ingo_rules                                   OK
horde.ingo_schema_info                             OK
horde.ingo_shares                                  OK
horde.ingo_shares_groups                           OK
horde.ingo_shares_users                            OK
horde.ingo_sharesng                                OK
horde.ingo_sharesng_groups                         OK
horde.ingo_sharesng_users                          OK
horde.ingo_spam                                    OK
horde.ingo_vacations                               OK
horde.kronolith_events                             OK
horde.kronolith_events_geo                         OK
horde.kronolith_events_mysqlgeo                    OK
horde.kronolith_resources                          OK
horde.kronolith_schema_info                        OK
horde.kronolith_shares                             OK
horde.kronolith_shares_groups                      OK
horde.kronolith_shares_users                       OK
horde.kronolith_sharesng                           OK
horde.kronolith_sharesng_groups                    OK
horde.kronolith_sharesng_users                     OK
horde.kronolith_storage                            OK
horde.mnemo_memos                                  OK
horde.mnemo_schema_info                            OK
horde.mnemo_shares                                 OK
horde.mnemo_shares_groups                          OK
horde.mnemo_shares_users                           OK
horde.mnemo_sharesng                               OK
horde.mnemo_sharesng_groups                        OK
horde.mnemo_sharesng_users                         OK
horde.nag_schema_info                              OK
horde.nag_shares                                   OK
horde.nag_shares_groups                            OK
horde.nag_shares_users                             OK
horde.nag_sharesng                                 OK
horde.nag_sharesng_groups                          OK
horde.nag_sharesng_users                           OK
horde.nag_tasks                                    OK
horde.rampage_objects                              OK
horde.rampage_tag_stats                            OK
horde.rampage_tagged                               OK
horde.rampage_tags                                 OK
horde.rampage_types                                OK
horde.rampage_user_tag_stats                       OK
horde.rampage_users                                OK
horde.turba_objects                                OK
horde.turba_schema_info                            OK
horde.turba_shares                                 OK
horde.turba_shares_groups                          OK
horde.turba_shares_users                           OK
horde.turba_sharesng                               OK
horde.turba_sharesng_groups                        OK
horde.turba_sharesng_users                         OK
information_schema
performance_schema
phpmyadmin
phpmyadmin.pma__bookmark                           OK
phpmyadmin.pma__central_columns                    OK
phpmyadmin.pma__column_info                        OK
phpmyadmin.pma__designer_settings                  OK
phpmyadmin.pma__export_templates                   OK
phpmyadmin.pma__favorite                           OK
phpmyadmin.pma__history                            OK
phpmyadmin.pma__navigationhiding                   OK
phpmyadmin.pma__pdf_pages                          OK
phpmyadmin.pma__recent                             OK
phpmyadmin.pma__relation                           OK
phpmyadmin.pma__savedsearches                      OK
phpmyadmin.pma__table_coords                       OK
phpmyadmin.pma__table_info                         OK
phpmyadmin.pma__table_uiprefs                      OK
phpmyadmin.pma__tracking                           OK
phpmyadmin.pma__userconfig                         OK
phpmyadmin.pma__usergroups                         OK
phpmyadmin.pma__users                              OK
psa
psa.APSApplicationItems                            OK
psa.APSCatalogUpdates                              OK
psa.APSClientApplicationItems                      OK
psa.APSLicenseTypes                                OK
psa.APSLicenses                                    OK
psa.ApiRpcCallsStat                                OK
psa.ApsTokens                                      OK
psa.BackendCache                                   OK
psa.BackupExcludeFiles                             OK
psa.BackupsScheduled                               OK
psa.BackupsSettings                                OK
psa.BlUpgradeActions                               OK
psa.BlUpgrades                                     OK
psa.CertificateRepositories                        OK
psa.CliCallsStat                                   OK
psa.ClientsTraffic                                 OK
psa.Configurations                                 OK
psa.DatabaseCustomHosts                            OK
psa.DatabaseServers                                OK
psa.DatabaseUserRemoteAccessRules                  OK
psa.DomainAliasesParameters                        OK
psa.DomainOutgoingMessagesPeaks                    OK
psa.DomainOutgoingMessagesStats                    OK
psa.DomainServices                                 OK
psa.DomainsTraffic                                 OK
psa.DynamicIpSecurity                              OK
psa.EmailActivations                               OK
psa.GL_remote_domains                              OK
psa.GL_settings                                    OK
psa.IP_Addresses                                   OK
psa.IisAppPoolDomains                              OK
psa.IisAppPools                                    OK
psa.IisAppPoolsPolicy                              OK
psa.IpAddressesCollections                         OK
psa.IpCollections                                  OK
psa.Limits                                         OK
psa.LimitsReservation                              OK
psa.Logos                                          OK
psa.MailLists                                      OK
psa.MailMessagesStat                               OK
psa.MailOutgoingMessagesPeaks                      OK
psa.MailOutgoingMessagesStats                      OK
psa.ModuleSettings                                 OK
psa.Modules                                        OK
psa.Notes                                          OK
psa.Notifications                                  OK
psa.PackageUpdateLocks                             OK
psa.PackageUpdateNotifications                     OK
psa.PanelNotificationMessages                      OK
psa.PanelNotificationTemplateSettings              OK
psa.Parameters                                     OK
psa.Permissions                                    OK
psa.PersistentCache                                OK
psa.PhpSettings                                    OK
psa.PhpSettingsCustom                              OK
psa.PhpSettingsParameters                          OK
psa.PlanItemProperties                             OK
psa.PlanItems                                      OK
psa.PlansSubscriptions                             OK
psa.PleskStats                                     OK
psa.Repository                                     OK
psa.RestrictedDomains                              OK
psa.SBConfig                                       OK
psa.SBResellers                                    OK
psa.ScheduledTasks                                 OK
psa.SchemaVersions                                 OK
psa.SecretKeys                                     OK
psa.SecretKeysIpAddresses                          OK
psa.ServiceNodeCache                               OK
psa.ServiceNodeCertificates                        OK
psa.ServiceNodeConfiguration                       OK
psa.ServiceNodeEnvironment                         OK
psa.ServiceNodes                                   OK
psa.SessionContexts                                OK
psa.SiteAppsHitsStat                               OK
psa.SitePagesStat                                  OK
psa.Skins                                          OK
psa.SubscriptionOutgoingMessagesPeaks              OK
psa.SubscriptionOutgoingMessagesStats              OK
psa.SubscriptionProperties                         OK
psa.Subscriptions                                  OK
psa.Templates                                      OK
psa.TmplData                                       OK
psa.TraceFailedRequestsProviderAreas               OK
psa.TraceFailedRequestsProviders                   OK
psa.TraceFailedRequestsRules                       OK
psa.UserSettings                                   OK
psa.WebServerSettings                              OK
psa.WebServerSettingsParameters                    OK
psa.Webmails                                       OK
psa.accounts                                       OK
psa.actions                                        OK
psa.admin_aliases                                  OK
psa.admin_aliases_param                            OK
psa.anon_ftp                                       OK
psa.apsContexts                                    OK
psa.apsContextsApplications                        OK
psa.apsInstancesParameters                         OK
psa.apsResources                                   OK
psa.apsResourcesParameters                         OK
psa.apscategories                                  OK
psa.avstatistics                                   OK
psa.badmailfrom                                    OK
psa.certificates                                   OK
psa.cl_param                                       OK
psa.clients                                        OK
psa.cp_access                                      OK
psa.custom_buttons                                 OK
psa.data_bases                                     OK
psa.db_users                                       OK
psa.disk_usage                                     OK
psa.dns_recs                                       OK
psa.dns_recs_t                                     OK
psa.dns_refs                                       OK
psa.dns_zone                                       OK
psa.dom_param                                      OK
psa.domain_aliases                                 OK
psa.domains                                        OK
psa.dsn                                            OK
psa.event_handlers                                 OK
psa.exp_event                                      OK
psa.externalWebmails                               OK
psa.forwarding                                     OK
psa.ftp_users                                      OK
psa.hosting                                        OK
psa.hotlink_friends                                OK
psa.hotlink_prot                                   OK
psa.ip_pool                                        OK
psa.key_history                                    OK
psa.key_history_params                             OK
psa.locales                                        OK
psa.log_actions                                    OK
psa.log_components                                 OK
psa.log_rotation                                   OK
psa.longtaskparams                                 OK
psa.longtasks                                      OK
psa.mail                                           OK
psa.mail_aliases                                   OK
psa.mail_redir                                     OK
psa.mail_resp                                      OK
psa.mass_mail                                      OK
psa.mass_mail_clients                              OK
psa.mass_mail_domains                              OK
psa.misc                                           OK
psa.mn_param                                       OK
psa.module_firewall_objects                        OK
psa.module_firewall_rules                          OK
psa.module_watchdog_disk                           OK
psa.module_watchdog_disk_event                     OK
psa.module_watchdog_param                          OK
psa.module_watchdog_report                         OK
psa.module_watchdog_service                        OK
psa.module_watchdog_service_event                  OK
psa.module_watchdog_sys_stat                       OK
psa.password_secrets                               OK
psa.pd_users                                       OK
psa.protected_dirs                                 OK
psa.report                                         OK
psa.report_auto                                    OK
psa.report_section                                 OK
psa.resp_attach                                    OK
psa.resp_forward                                   OK
psa.resp_freq                                      OK
psa.secret_keys                                    OK
psa.sessions                                       OK
psa.smb_apsBundleFilterItems                       OK
psa.smb_apsBundleFilters                           OK
psa.smb_apsCategories                              OK
psa.smb_apsContexts                                OK
psa.smb_apsInstanceErrors                          OK
psa.smb_apsInstances                               OK
psa.smb_apsMetas                                   OK
psa.smb_apsPackageUpdates                          OK
psa.smb_apsPackages                                OK
psa.smb_apsPackagesCategories                      OK
psa.smb_apsProvisionEnvironments                   OK
psa.smb_apsProvisions                              OK
psa.smb_apsResourceParameters                      OK
psa.smb_apsResources                               OK
psa.smb_apsSettings                                OK
psa.smb_componentUpdates                           OK
psa.smb_generalPermissions                         OK
psa.smb_locales                                    OK
psa.smb_productUpgrades                            OK
psa.smb_roleGeneralPermissions                     OK
psa.smb_roleServicePermissions                     OK
psa.smb_roles                                      OK
psa.smb_serviceEntryPoints                         OK
psa.smb_serviceInstances                           OK
psa.smb_servicePermissionAccounts                  OK
psa.smb_servicePermissions                         OK
psa.smb_serviceProviders                           OK
psa.smb_settings                                   OK
psa.smb_userServicePermissions                     OK
psa.smb_users                                      OK
psa.smtp_poplocks                                  OK
psa.spamfilter                                     OK
psa.spamfilter_preferences                         OK
psa.stat                                           OK
psa.subdomains                                     OK
psa.suspend_handler_history                        OK
psa.sys_users                                      OK
psa.upgrade_history                                OK
psa.web_users                                      OK
psa.webalizer_group_referrer                       OK
psa.webalizer_hidden_referrer                      OK
roundcubemail
roundcubemail.cache                                OK
roundcubemail.cache_index                          OK
roundcubemail.cache_messages                       OK
roundcubemail.cache_shared                         OK
roundcubemail.cache_thread                         OK
roundcubemail.contactgroupmembers                  OK
roundcubemail.contactgroups                        OK
roundcubemail.contacts                             OK
roundcubemail.dictionary                           OK
roundcubemail.filestore                            OK
roundcubemail.identities                           OK
roundcubemail.searches                             OK
roundcubemail.session                              OK
roundcubemail.system                               OK
roundcubemail.users                                OK
Phase 7/7: Running 'FLUSH PRIVILEGES'
OK
Informing Plesk of the changes (plesk sbin packagemng -sdf)
Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.


```

```shell
[root@server ~]# mysql -V
mysql  Ver 15.1 Distrib 10.5.12-MariaDB, for Linux (x86_64) using readline 5.1
```

無事アップグレードされました。
所要時間は 2 分ほど、DB の量が大量だと伸びると思われる。

## Manual でアップグレード

上記のスクリプトの内容を 1 行ずつ実行すればできる。

## 参考

<OgpLink url="https://support.plesk.com/hc/en-us/articles/213403429--How-to-upgrade-MySQL-5-5-to-5-6-5-7-or-MariaDB-5-5-to-10-x-on-Linux-" />

おしまい
